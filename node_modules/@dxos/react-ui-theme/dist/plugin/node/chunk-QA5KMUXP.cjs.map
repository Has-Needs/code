{
  "version": 3,
  "sources": ["../../../src/plugins/resolveContent.ts"],
  "sourcesContent": ["//\n// Copyright 2023 DXOS.org\n//\n\nimport { glob as globCb } from 'glob';\nimport { promisify } from 'node:util';\n\nconst glob = promisify(globCb);\n\n/**\n *\n */\n// TODO(burdon): Comment.\nconst knownIndirectPeers = [\n  '@dxos/gem-*',\n  '@dxos/react-*',\n  '@dxos/react-ui-*',\n  '@dxos/devtools',\n  '@dxos/shell',\n  // TODO(thure): glob v7 runs out of memory if we do a `**` search, and this is (hopefully) the only L3 content package; find a better solution.\n  '@dxos/react-ui-table/node_modules/@dxos/react-ui-searchlist',\n];\n\nconst knownDirectPeers = ['@dxos/plugin-*', ...knownIndirectPeers];\n\nconst packageNamePattern = /.*node_modules\\/(.+?)$/;\nconst packageName = (path: string) => path.match(packageNamePattern)?.[1];\n\nconst flatten = (acc: string[], group: string[]) => [...acc, ...group];\nconst dedupe = (acc: Record<string, string>, path: string) => {\n  const name = packageName(path);\n  if (name && !acc[name]) {\n    acc[name] = path;\n  }\n  return acc;\n};\n\nexport const resolveKnownPeers = async (content: string[], cwd: string): Promise<string[]> => {\n  const globOptions = { cwd, absolute: true };\n\n  const directPeers = await Promise.all(knownDirectPeers.map((peer) => glob(`./node_modules/${peer}`, globOptions)));\n\n  // NOTE(thure): With glob v7, JS runs out of memory if `**` is used, so this limits the search to @dxos/plugin-*/node_modules\n  const indirectPeers = await Promise.all(\n    knownIndirectPeers.map((peer) => glob(`./node_modules/@dxos/plugin-*/node_modules/${peer}`, globOptions)),\n  );\n\n  const knownPeerContent = Object.values(\n    indirectPeers.reduce(flatten, []).reduce(dedupe, directPeers.reduce(flatten, []).reduce(dedupe, {})),\n  ).map((value) => `${value}/dist/lib/**/*.mjs`);\n\n  // console.log('[found known peer content paths]', knownPeerContent);\n\n  return [...content, ...knownPeerContent];\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAIA,kBAA+B;AAC/B,uBAA0B;AAE1B,IAAMA,WAAOC,4BAAUC,YAAAA,IAAAA;AAMvB,IAAMC,qBAAqB;EACzB;EACA;EACA;EACA;EACA;;EAEA;;AAGF,IAAMC,mBAAmB;EAAC;KAAqBD;;AAE/C,IAAME,qBAAqB;AAC3B,IAAMC,cAAc,CAACC,SAAiBA,KAAKC,MAAMH,kBAAAA,IAAsB,CAAA;AAEvE,IAAMI,UAAU,CAACC,KAAeC,UAAoB;KAAID;KAAQC;;AAChE,IAAMC,SAAS,CAACF,KAA6BH,SAAAA;AAC3C,QAAMM,OAAOP,YAAYC,IAAAA;AACzB,MAAIM,QAAQ,CAACH,IAAIG,IAAAA,GAAO;AACtBH,QAAIG,IAAAA,IAAQN;EACd;AACA,SAAOG;AACT;AAEO,IAAMI,oBAAoB,OAAOC,SAAmBC,QAAAA;AACzD,QAAMC,cAAc;IAAED;IAAKE,UAAU;EAAK;AAE1C,QAAMC,cAAc,MAAMC,QAAQC,IAAIjB,iBAAiBkB,IAAI,CAACC,SAASvB,KAAK,kBAAkBuB,IAAAA,IAAQN,WAAAA,CAAAA,CAAAA;AAGpG,QAAMO,gBAAgB,MAAMJ,QAAQC,IAClClB,mBAAmBmB,IAAI,CAACC,SAASvB,KAAK,8CAA8CuB,IAAAA,IAAQN,WAAAA,CAAAA,CAAAA;AAG9F,QAAMQ,mBAAmBC,OAAOC,OAC9BH,cAAcI,OAAOnB,SAAS,CAAA,CAAE,EAAEmB,OAAOhB,QAAQO,YAAYS,OAAOnB,SAAS,CAAA,CAAE,EAAEmB,OAAOhB,QAAQ,CAAC,CAAA,CAAA,CAAA,EACjGU,IAAI,CAACO,UAAU,GAAGA,KAAAA,oBAAyB;AAI7C,SAAO;OAAId;OAAYU;;AACzB;",
  "names": ["glob", "promisify", "globCb", "knownIndirectPeers", "knownDirectPeers", "packageNamePattern", "packageName", "path", "match", "flatten", "acc", "group", "dedupe", "name", "resolveKnownPeers", "content", "cwd", "globOptions", "absolute", "directPeers", "Promise", "all", "map", "peer", "indirectPeers", "knownPeerContent", "Object", "values", "reduce", "value"]
}
