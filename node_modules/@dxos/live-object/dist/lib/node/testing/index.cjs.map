{
  "version": 3,
  "sources": ["../../../../src/testing/echo-schema.ts"],
  "sourcesContent": ["//\n// Copyright 2024 DXOS.org\n//\n\nimport { effect } from '@preact/signals-core';\nimport { type Schema } from 'effect';\n\nimport { EchoSchema, getSchemaTypename, StoredSchema, toJsonSchema } from '@dxos/echo-schema';\nimport { registerSignalsRuntime } from '@dxos/echo-signals';\nimport { assertArgument } from '@dxos/invariant';\n\nimport { live } from '../object';\n\n// NOTE: Registration is done here is this is the module that calls out to `effect`.\nregisterSignalsRuntime();\n\n/**\n * Create a reactive mutable schema that updates when the JSON schema is updated.\n */\n// TODO(dmaretskyi): Should be replaced by registration of typed object.\nexport const createEchoSchema = (schema: Schema.Schema.AnyNoContext): EchoSchema => {\n  const typename = getSchemaTypename(schema);\n  assertArgument(typename, 'Schema does not have a typename.');\n\n  const echoSchema = new EchoSchema(\n    live(StoredSchema, {\n      typename,\n      version: '0.1.0',\n      jsonSchema: toJsonSchema(schema),\n    }),\n  );\n\n  // TODO(burdon): Unsubscribe is never called.\n  effect(() => {\n    const _ = echoSchema.jsonSchema;\n    echoSchema._invalidate();\n  });\n\n  return echoSchema;\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAIA,0BAAuB;AAGvB,yBAA0E;AAC1E,0BAAuC;AACvC,uBAA+B;IAK/BA,4CAAAA;AAMO,IAAMC,mBAAmB,CAACC,WAAAA;AAC/B,QAAMC,eAAWC,sCAAkBF,MAAAA;AACnCG,uCAAeF,UAAU,kCAAA;AAEzB,QAAMG,aAAa,IAAIC,kCACrBC,4BAAKC,iCAAc;IACjBN;IACAO,SAAS;IACTC,gBAAYC,iCAAaV,MAAAA;EAC3B,CAAA,CAAA;AAIFW,kCAAO,MAAA;AACL,UAAMC,IAAIR,WAAWK;AACrBL,eAAWS,YAAW;EACxB,CAAA;AAEA,SAAOT;AACT;",
  "names": ["registerSignalsRuntime", "createEchoSchema", "schema", "typename", "getSchemaTypename", "assertArgument", "echoSchema", "EchoSchema", "live", "StoredSchema", "version", "jsonSchema", "toJsonSchema", "effect", "_", "_invalidate"]
}
